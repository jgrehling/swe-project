<html ng-app>
<head>
  <meta charset="utf8" />
  <title>AngularJS Tutorial</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
 
   <script src="http://code.jquery.com/jquery-1.10.2.js"></script>

<div id="arrayDrawn">



</div>
<script type="text/javascript">

var defaultColour = 0;
var counter = 1;
var counter_s = 100;

$( document ).ready(function() {
    
	
	var area = [];
	area[0] = [];
	area[1] = [];
	area[2] = [];
	area[0][0] = defaultColour;
	area[0][1] = defaultColour;
	area[1][0] = defaultColour;
	area[1][1] = defaultColour;
	area[0][2] = defaultColour;
	area[1][2] = defaultColour;
	area[1][1] = defaultColour;
	area[2][0] = defaultColour;
	area[2][1] = defaultColour;
	area[2][2] = defaultColour;

	// can be between 0 and 3 (0 equals north, 1 equals east, 2 equals south, 3 equals west)
	var orientation = 2;
	var position = [1,1]
	
	nextStep(area, position, orientation);
});

/**
 * Function changes orientation variable
 *
 * @params rotateLeft - true for a left rotation, false for a right rotation
 * @returns orientation
 */
function changeOrientation(rotateLeft, orientation) {
	if(rotateLeft) {
		orientation --;
		if(orientation < 0) {
			orientation = 3;
		}
	} else {
		orientation++;
		if(orientation > 3) {
			orientation = 0;
		}
		
	}
	
	return orientation;
}

/**
 * Inverts the field color in the area array at the given position coordinates.
 *
 * @returns area array
 */
 function invertColour(area, position) {
	if(area[position[0]][position[1]] == 0) {
		area[position[0]][position[1]] = 1;
	} else {
		area[position[0]][position[1]] = 0;
	}
	
	return area;
 }
 
 function moveFocus(position, orientation) {

	switch(orientation) {
		case 0:
			position[1] = parseInt(position[1]) + 1;
			break;
		case 1:
			position[0] = parseInt(position[0]) + 1;
			break;
		case 2:
			position[1] = parseInt(position[1]) - 1;
			break;
		case 3:
			position[0] = parseInt(position[0]) - 1;
			break;
	}
	
	return position;
 }
 
 function centerFocusInArea(area, position) {
	// we have to add a vertical line at the right of the field
	if(area[position[0]+1] == undefined) {
	
		area[position[0]+1] = [];
		
		var length = area[position[0]].length;
		console.log(length);
		for (var i = 0; i < length; i++) {
			area[position[0]+1][i] = defaultColour;
		}
		
	// we have to add a horizontal line at the top of the field
	} else if(area[position[0]][position[1]+1] == undefined) {
				
		$(area).each(function() {
			this[position[1]+1] = defaultColour;
		});
	
	// we have to add a vertical line at the left side of the field
	} else if(position[0]-1 < 0) {
		var tempArray = [];
		var length = area[position[0]].length;
		
		for (var i = 0; i < length; i++) {
			tempArray[i] = defaultColour;
		}
		area.unshift(tempArray);
		position[0]++;
		
	// we have to add a horizontal line at the bottom of the field
	} else if(position[1]-1 < 0) { 
		
		$(area).each(function() {
			this.unshift(defaultColour);
		});
		position[1] ++;
	} 
	
	return [area, position];
 }
 
 function setOrientationBorder(position, orientation) {
 
	switch(orientation) {
		case 0:
			$("#" + position[0] + "_" + position[1]).addClass("border-top");
			break;
		case 1:
			$("#" + position[0] + "_" + position[1]).addClass("border-right");
			break;
		case 2:
			$("#" + position[0] + "_" + position[1]).addClass("border-bottom");
			break;
		case 3:
			$("#" + position[0] + "_" + position[1]).addClass("border-left");
			break;
	}
 }
 
 function drawArray(area, position, orientation) {
	var content = "<table>";
	var xLength = area.length;
	var yLength = area[0].length;
	
	for(var i=yLength-1; i >= 0; i--) {
		content += "<tr>";
		
		for(var j=0; j < xLength; j++) {
			content += "<td id='" + j + "_" + i + "'></td>";
		}
		
		content += "</tr>";
	}
		
	content += "</table>";

	$('#arrayDrawn').html(content);
	
	$(area).each(function(xIndex) {
	
		$(this).each(function(yIndex) {
			$("#" + xIndex + "_"+ yIndex).html(this);
		});
	
	});
	
	$("#" + position[0] + "_" + position[1]).addClass('currentPosition');
	setOrientationBorder(position, orientation);
	
 }
 
 function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

/**
 *
 *
 *
 */
function nextStep(area, position, orientation) {
	console.log("######Before######");
	console.log(area);
	console.log(position);
	console.log(orientation);
	// field is black
	if(area[position[0]][position[1]-1] == 1) {
		// rotate 90 degree to the left
		orientation = changeOrientation(true, orientation);
	// field is white
	}else{
		// rotate 90 degree to the right
		orientation = changeOrientation(false, orientation);
	}
	// invert colour of the currently focused field
	area = invertColour(area, position);
	position = moveFocus(position, orientation);
	temp = centerFocusInArea(area, position);
	area = temp[0];
	position = temp[1];
	console.log("######After######");
	console.log(area);
	console.log(position);
	console.log(orientation);
	console.log("#############################################");
	drawArray(area, position, orientation);
	if(counter < counter_s) {
		counter ++;
		setTimeout(function() { nextStep(area, position, orientation) }, 1000 );
		//nextStep(area, position, orientation);
	};
	
}

</script>
</body>
</html>